<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>管理系统后台登录</title>
	<link rel="stylesheet" href="layui/css/layui.css" />
	<link rel="stylesheet" href="layui/css/style.css" />
	<script type="text/javascript" src="layui/layui.js"></script>
	<script type="text/javascript" src="lib/jquery-1.8.3.min.js"></script>
	<script type="text/javascript" src="lib/jquery.md5.js"></script>
	<script type="text/javascript" src="js/num.js"></script>
	<script type="text/javascript" src="js/service.js"></script>
	<script type="text/javascript" src="js/layer.com.js"></script>
	<style>
		body {
			background: #f2f2f2;
		}

		.layui-tab-title li {
			width: 50%;
			padding: 0;
		}

		.layui-tab-title .layui-this {
			color: #009688;
		}

		.layui-tab-title .layui-this:after {
			display: none;
		}
	</style>
</head>

<body>
	<div id="mydiv">
		<div class="login-main">
			<div class="layui-elip">管理系统后台登录</div>
			<form class="layui-form" autocomplete="off">
				<div class="layui-form-item">
					<div class="layui-input-inline input-item">
						<label for="username">手机号码/账号/身份证号码</label>
						<input type="text" name="username" lay-verify="required" placeholder="手机号码/账号/身份证号码"
							class="layui-input">
					</div>
					<div class="layui-input-inline input-item">
						<label for="pwd">密码</label>
						<input type="password" name="password" lay-verify="required" placeholder="密码"
							class="layui-input input-val">
					</div>
					<div class="layui-input-inline input-item verify-box">
						<label for="verify">验证码</label>
						<input type="text" name="verify" placeholder="验证码" class="layui-input">
						<canvas id="canvas" class="captcha" width="120" height="36"></canvas>
					</div>
					<div class="layui-input-inline login-btn">
						<input type="button" class="layui-btn" style="width: 100%" value="登录" lay-submit
							lay-filter="login">
					</div>
					<p class="text-right">
						<a href="忘记密码.html">忘记密码</a>
					</p>
				</div>
			</form>
		</div>
	</div>
	<script>
		layui.use(['form', 'layer', 'jquery'], function () {
			var form = layui.form,
				layer = layui.layer,
				$ = layui.jquery;

			//表单输入效果
			$(".login-main .input-item").click(function (e) {
				e.stopPropagation();
				$(this).addClass("layui-input-focus").find(".layui-input").focus();
			})
			$(".login-main .input-item .layui-input").focus(function () {
				$(this).parent().addClass("layui-input-focus");
			})
			$(".login-main .input-item .layui-input").blur(function () {
				$(this).parent().removeClass("layui-input-focus");
				if ($(this).val() != '') {
					$(this).parent().addClass("layui-input-active");
				} else {
					$(this).parent().removeClass("layui-input-active");
				}
			})

			//刷新验证码
			$("#verify").click(function () {
				var verifyimg = $("#verify").attr("src");
				$("#verify").attr("src", verifyimg.replace(/\?.*$/, '') + '?' + Math.random());
			});

			function parseJwt(token) {
				var base64Url = token.split('.')[1];
				var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
				return JSON.parse(window.atob(base64));
			};

			form.on('submit(login)', function (data) {
				layer_load();
				data.field.client_id = verifyModel.pwd.client_id;
				data.field.client_secret = verifyModel.pwd.client_secret;
				data.field.grant_type = verifyModel.pwd.grant_type;
				data.field.password = $.md5(data.field.password + verifyModel.salt.letter1 + verifyModel.salt
						.letter2)
					.toUpperCase();
				Serv.Post("uc/account/signin", data.field, function (result) {
					layer_load_lose();
					console.log(result);


					Serv.SetToken(result.token_type + " " + result.access_token);
					
					var token = parseJwt(result.access_token);
					console.log(token);

					// Serv.Get('user/init', null, function (response) {
					// 	response.UserInfo = token;
					// 	var stringJson = JSON.stringify(response);
					// 	localStorage.setItem("LOCAL_USER_DATA", stringJson);
					// 	layer.closeAll();
					// 	window.location.href = 'pages/index.html';
					// });
				});
				return false;
			});
		})
	</script>
</body>

</html>