<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title></title>
	<link rel="stylesheet" href="../../layui/css/layui.css" />
	<link rel="stylesheet" href="../../layui/css/common.css" />
	<script type="text/javascript" src="../../lib/jquery-1.8.3.min.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../js/service.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../js/pager.js"></script>
</head>

<body class="bgf2f2f2">
	<div class="childrenBody">
		<div class="layui-card">
			<div class="layui-card-body">
				<div class="layui-tab " lay-filter="component-tabs-brief">
					<div class="layui-tab-content">
						<div class="layui-tab-item layui-show">
							<form class="layui-form layui-form2 layui-search-form">
								<div class="layui-row">
									<div class="layui-form-item layui-col-md3 margin-b-20">
										<label class="layui-form-label">姓名</label>
										<div class="layui-input-block">
											<input type="text" name="title" required lay-verify="required"
												placeholder="请输入姓名" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md3 margin-b-20">
										<label class="layui-form-label">手机</label>
										<div class="layui-input-block">
											<input type="text" name="title" required lay-verify="required"
												placeholder="请输入手机" autocomplete="off" class="layui-input">
										</div>
									</div>
									<div class="layui-form-item layui-col-md2 margin-b-20">
										<button class="layui-btn layui-btn-normal">搜索</button>
									</div>
								</div>
							</form>
							<table id="lst" lay-filter="lst"></table>
							<script type="text/html" id="toolbar">
								<button class="layui-btn layui-btn-xs" lay-event="view">查看</button>
								<button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit">编辑</button>
								<button class="layui-btn layui-btn-xs layui-btn-normal" lay-event="openAccount">开通账户</button>
								<button class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</button>
							</script>
							<script type="text/html" id="bar">
							</script>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		var data_col = [
			[{
					field: 'id',
					title: '序号'
				},
				{
					field: 'dptName',
					title: '部门'
				},
				{
					field: 'jobName',
					title: '职位',
					width: 80
				},
				{
					field: 'userName',
					title: '姓名',
					width: 80
				},
				{
					field: 'status',
					title: '状态',
					templet: function (d) {
						return ['未入职', '试用', '转正', '离职'][d.status];
					}
				},
				{
					field: 'isOpenAccount',
					title: '开通账户',
					templet: function (d) {
						return d.isOpenAccount ? '<span class="text-span">已开通</span>' : '<span class="text-del">未开通</span>';
					}
				},
				{
					field: 'employeeNo',
					title: '工号'
				},
				{
					field: 'roles',
					title: '角色'
				},
				{
					field: 'gender',
					title: '性别',
					width: 60,
					templet: function (d) {
						return ["", "男", "女"][d.gender]
					}
				},
				{
					field: 'linkPhone',
					title: '电话',
					width: 120
				},
				{
					field: 'officePhone',
					title: '办公电话',
					width: 120
				},
				{
					title: '操作',
					toolbar: '#toolbar',
					width: 170
				}
			]
		];

		var parameter = {
			companyId: 1,
			linkPhone: '',
			userName: ''
		};

		layui.use(['table', 'element'], function () {
			var table = layui.table,
				element = layui.element;

			function search() {
				return parameter;
			}

			//操作栏的回调函数
			var onTools = function (layEvent, data) {
				var value = data.id;
				if (layEvent === 'view') {
					window.location.href = '/pages/person/personDetails.html?id=' + value;
				} else if (layEvent === 'edit') {
					window.location.href = '/pages/person/personAdd.html?id=' + value;
				} else if (layEvent === 'openAccount') {
					layer_confirm('确定开通账户吗？', function () {
						layer_load();
						Serv.Get('uc/employee/openaccount/' + value, {}, function (result) {
							if (result.succeed) {
								layer_alert('开户成功', function () {
									lstPager.refresh();
								});
							} else {
								layer_alert(result.message);
							}
						});
					});
				} else if (layEvent === "del") {
					layer_confirm('确定删除吗？', function () {
						layer_load();
						Serv.Get('uc/company/delete/' + value, {}, function (result) {
							if (result.succeed) {
								layer_alert(result.message, function () {
									lstPager.refresh();
								});
							} else {
								layer_alert(result.message);
							}
						});
					});
				}
			};

			//分页初始化
			var lstPager = Pager(table, //lay-ui的table控件
				'员工列表', //列表名称
				'lst', //绑定的列表Id
				'', //绑定的工具条Id
				data_col, //表头的显示行
				'uc/employee/get', //action url 只能post提交
				search, //获取查询条件的函数
				null, //如果在显示之前需要对数据进行整理需要实现，否则传null
				null, //有选择行才能有的操作，实现该方法,否则传null
				onTools, //如果有每行的操作栏的操作回调，实现该方法，否则传null
				null,
				'full-100'
			);
		});
	</script>
</body>

</html>