<link rel="stylesheet" href="../../lib/ztree/css/metroStyle/metroStyle.css" type="text/css">
<script type="text/javascript" src="../../lib/ztree/jquery.ztree.all.min.js"></script>
<div class="layui-card">
	<form class="layui-form layui-search-form">
		<div class="layui-row margin-t-10">
			<div class="search_item">
				<span>公司</span>
				<div class="fl">
					<select>
						<option></option>
						<option>本公司</option>
						<option>公司一</option>
						<option>公司二</option>
					</select>
				</div>
			</div>
			<div class="search_item" style="position: relative;">
				<span>部门</span>
				<input type="text" name="title" placeholder="请输入部门" autocomplete="off" class="layui-input" id="user_select_department" onclick="show_user_select_tree()" readonly />
				<input type="hidden" id="department_id" />
				<ul id="user_select_tree" class="ztree"></ul>
			</div>
			<div class="search_item">
				<span>职位</span>
				<div class="fl">
					<select>
						<option></option>
						<option>经理</option>
						<option>总监</option>
						<option>主管</option>
					</select>
				</div>
			</div>
			<div class="search_item">
				<span>姓名</span><input type="text" name="title" placeholder="请输入姓名" autocomplete="off" class="layui-input">
			</div>
			<div class="search_item">
				<button class="layui-btn layui-btn-normal">搜索</button>
			</div>	
		</div>
	</form>
	<table id="user_select_lst" lay-filter="user_select_lst"></table>
	<script type="text/html" id="toolbar">
		<button class="layui-btn  layui-btn-xs ">查看</button>
		<button class="layui-btn  layui-btn-xs layui-btn-normal">编辑</button>
		<button class="layui-btn  layui-btn-xs layui-btn-danger">删除</button>
	</script>
</div>
<script type="text/javascript">
	$(function(){
		var data_col = [[
			{type:'checkbox'},
			{field: 'name', title: '名称'},
			{field: 'lx', title: '职位'},
			{field: 'jb', title: '部门'},
		]];
		var datas = [
			{'id':1,'name':'经理','lx':'管理','jb':'M1'},
			{'id':2,'name':'副经理','lx':'管理','jb':'M2'},
			{'id':3,'name':'市场总监','lx':'管理','jb':'M3'},
			{'id':4,'name':'经理','lx':'管理','jb':'M1'},
			{'id':5,'name':'副经理','lx':'管理','jb':'M2'},
			{'id':6,'name':'市场总监','lx':'管理','jb':'M3'},
			{'id':7,'name':'经理','lx':'管理','jb':'M1'},
			{'id':8,'name':'副经理','lx':'管理','jb':'M2'},
			{'id':9,'name':'市场总监','lx':'管理','jb':'M3'}
		];
		layui.use([ 'table','form'], function() {
			var table = layui.table,
				form = layui.form;
				table.render({
					elem: '#user_select_lst',
					data: datas,
					cols: data_col,
					limit:5,
					page:true,
					height:'280'
				});
				form.render('select');
		});
		var zTreeObj;
		var setting = {
			check: {
				enable: true,
				chkboxType: {"Y":"", "N":""}
				/* chkStyle: "radio",
				radioType: "all" */
			},
			view: {
			    dblClickExpand: false
			},
			callback: {
				onCheck: on_user_select_check,
			    onClick: function (e, treeId, treeNode) {
			        var tree = $.fn.zTree.getZTreeObj(treeId);
			        tree.expandNode(treeNode);
			
					tnode=treeNode;
			        currentid=treeNode.id;
			    }
			}
		};
		var zNodes = [ // zTree 的数据属性，此处使用标准json格式
			{
				id:1,
				name: "四川某某公司",
				open: true,
				children: [{
						name: "销售部",
						id:2,
						children: [{
							name: "销售1部",
							id:3,
							children: [{
								name: "销售1组",
								id:4,
							}]
						}]
					},
					{
						name: "市场部",
						id:5,
					},
					{
						name: "销售部",
						id:6,
						children: [{
							name: "销售1部",
							id:7,
						}]
					}
				]
			}
		
		];
		zTreeObj = $.fn.zTree.init($("#user_select_tree"), setting, zNodes);
	});
	function show_user_select_tree() {
		$("#user_select_tree").show();
		$("body").bind("mousedown", onuser_select_BodyDown);
	}
	function hide_user_select_tree() {
		$("#user_select_tree").hide();
		$("body").unbind("mousedown", onuser_select_BodyDown);
	}
	function onuser_select_BodyDown(event) {
		if (!(event.target.id == "user_select_department" || $(event.target).parents("#user_select_tree").length>0)) {
			hide_user_select_tree();
		}
	}
	function on_user_select_check(e, treeId, treeNode) {
		var zTree = $.fn.zTree.getZTreeObj(treeId),
		nodes = zTree.getCheckedNodes(true),
		v = "",id = "";
		for (var i=0, l=nodes.length; i<l; i++) {
			v += (v == "" ) ? nodes[i].name : ','+nodes[i].name ;
			id += (id == "" ) ? nodes[i].id : ','+nodes[i].id;
		}
		$("#user_select_department").val(v);
		$("#department_id").val(id);
	}
</script>