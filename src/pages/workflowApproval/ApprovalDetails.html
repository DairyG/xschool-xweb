<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<link rel="stylesheet" href="../../layui/css/layui.css" />
		<link rel="stylesheet" href="../../layui/css/common.css" />
		<link rel="stylesheet" href="../../layui/css/template.css" />
		<script type="text/javascript" src="../../lib/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="../../layui/layui.js"></script>
		<script type="text/javascript" src="../../js/service.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript" src="../../js/layer.com.js"></script>
		<script type="text/javascript" src="../../lib/form_build.js"></script>
	</head>
	<body class="bgf2f2f2">
		<div class="childrenBody">
			<div class="layui-card-body bgwhite">
				<div class="layui-tab margin-t-0">
					<ul class="layui-tab-title">
						<li class="fontsize-16">付款申请</li>
						<span class="layui-btn layui-btn-sm fr" onclick="history.back(-1)">返回</span>
					</ul>
					<div class="layui-tab-content">
						<span class="process_state_img"><img src='../../img/process_s2.png' /></span>
						<div class="layui-tab-item layui-show">
							<ul class="process_step" id="process_step">
							</ul>
							<div id="detail">
							</div>
							<hr class="layui-bg-blue hrheight3">
							<div class="form-title">审批：</div>
							<div class="layui-form layui-form2">
								<div class="layui-row">
									<div class="layui-form-item layui-col-md12 margin-b-20">
										<label class="layui-form-label"><span class="text-red">*</span>是否同意</label>
										<div class="layui-input-block">
											<input type="radio" name="opinion" value="2" title="同意申请" />
											<input type="radio" name="opinion" value="-1" title="不同意申请" />
											<input type="radio" name="opinion" value="-2" title="驳回申请" />
										</div>
									</div>
									<div class="layui-form-item layui-col-md12 margin-b-20">
										<label class="layui-form-label">审批意见</label>
										<div class="layui-input-block">
											<textarea class="layui-textarea" id="Memo"></textarea>
										</div>
									</div>
								</div>
							</div>
							<div class="layui-row">
								<div class="layui-input-block text-right">
									<a class="layui-btn layui-btn-danger" onclick="save()">确定</a>
									<span class="layui-btn" onclick="history.back(-1)">返回</span>
								</div>
							</div>
							<hr class="layui-bg-blue hrheight3">
							<div class="form-title">审批日志：</div>
							<ul class="layui-timeline">
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">发起申请</h3>
										<div>
											<p>
												<font class="text-a cpr">张三</font> 2019-1-1 10:00:22
											</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">审批人</h3>
										<div>
											<p>
												<font class="text-a cpr">张三</font> 2019-1-1 10:00:22
											</p>
											<p>通过申请</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">审批人</h3>
										<div>
											<p>
												<font class="text-a cpr">张三</font>（已转交） 2019-1-1 10:00:22
											</p>
											<p>张三 将审批人从 张三 转交为 李四</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">审批人</h3>
										<div>
											<p>
												<font class="text-a cpr">张三</font> 李四会签（审批中）
											</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">抄送人</h3>
										<div>
											<p>
												<font class="text-a cpr">张三</font> 2019-1-1 10:00:22
											</p>
											<p>抄送人 张三 已读</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">抄送人</h3>
										<div>
											<p>
												<font class="text-a cpr">李四</font>
											</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">审批人</h3>
										<div>
											<p>
												<font class="text-a cpr">李四</font> 2019-1-1 10:00:22
											</p>
											<p>审批人李四已同意申请</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">审批人</h3>
										<div>
											<p>
												<font class="text-a cpr">李四</font>
											</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">复核人</h3>
										<div>
											<p>
												<font class="text-a cpr">王五</font>
											</p>
										</div>
									</div>
								</li>
								<li class="layui-timeline-item">
									<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
									<div class="layui-timeline-content layui-text">
										<h3 class="layui-timeline-title">复核人</h3>
										<div>
											<p>
												<font class="text-a cpr">王五</font>
											</p>
										</div>
									</div>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="linePop linePop2 layadmin-maillist-fluid">
			<div class="layadmin-contact-box">
				<div class="layui-col-md4 layui-col-sm6">
					<a href="javascript:;">
						<div class="layadmin-text-center">
							<img src="../../img/head.jpg">
							<div class="layadmin-maillist-img layadmin-font-blod">在职</div>
						</div>
					</a>
				</div>
				<div class="layui-col-md8 layadmin-padding-left20 layui-col-sm6">
					<h3 class="layadmin-title">
						<strong>张三</strong> <i class="layui-icon layui-icon-male"></i>
					</h3>
					<div class="layadmin-address layui-row" style="line-height: 1.8;margin-bottom: 0;">
						<div class="layui-col-md12">028-3453452</div>
						<div class="layui-col-md6">销售部</div>
						<div class="layui-col-md6">经理</div>
						<div class="layui-col-md6">销售部</div>
						<div class="layui-col-md6">经理</div>
						<div class="layui-col-md6">销售部</div>
						<div class="layui-col-md6">经理</div>
					</div>
				</div>
			</div>
		</div>
		<script type="text/html" id="process_step_tpl">
			<li class="active padding-l-0"><i>1</i><span>发起申请</span></li>
			{{#  layui.each(d, function(index, item){ }}
				<li {{# if(item.auditNo){ }} class="active" {{# } }}><i>{{index+2}}</i><span>{{item.passName}}</span></li>
			{{#  }); }}
			<li class="padding-r-0"><i>4</i><span>流程完成</span></li>
		</script>
		<script type="text/html" id="detailTpl">
			<div class="form-title">发起人信息：</div>
			<div class="layui-form layui-form2  layui-form-140 layui-form-info">
				<div class="layui-row">
					<div class="layui-form-item layui-col-md6 margin-b-20">
						<label class="layui-form-label">流程编号：</label>
						<div class="layui-input-block">
							<div class="layui-form-mid">{{d.businessCode}}</div>
						</div>
					</div>
					<div class="layui-form-item layui-col-md6 margin-b-20">
						<label class="layui-form-label">发起时间：</label>
						<div class="layui-input-block">
							<div class="layui-form-mid">{{d.createtime}}</div>
						</div>
					</div>
					<div class="layui-form-item layui-col-md6 margin-b-20">
						<label class="layui-form-label">发起公司：</label>
						<div class="layui-input-block">
							<div class="layui-form-mid">{{d.companyName}}</div>
						</div>
					</div>
					<div class="layui-form-item layui-col-md6 margin-b-20">
						<label class="layui-form-label">发起部门：</label>
						<div class="layui-input-block">
							<div class="layui-form-mid">{{d.depName}}</div>
						</div>
					</div>
					<div class="layui-form-item layui-col-md6 margin-b-20">
						<label class="layui-form-label">发起人姓名：</label>
						<div class="layui-input-block">
							<div class="layui-form-mid">{{d.createUserName}}</div>
						</div>
					</div>
					<div class="layui-form-item layui-col-md6 margin-b-20">
						<label class="layui-form-label">发起人职位：</label>
						<div class="layui-input-block">
							<div class="layui-form-mid">{{d.jobName}}</div>
						</div>
					</div>
				</div>
			</div>
			<hr class="layui-bg-blue hrheight3">
			<div class="form-title">申请详情：</div>
			{{d.apply_info}}
		</script>
		<script type="text/javascript">
			var layer_linePop, table,laytpl;
			var Id = GetPara('Id');
			layer_load();
			layui.use(['table', 'form', 'laydate','laytpl'], function() {
				table = layui.table;
				laytpl = layui.laytpl;
				var form = layui.form,
					laydate = layui.laydate;
				laydate.render({
					elem: '#date1'
				});

				if (Id > 0) {
					//获取发起人信息和审核进度
					GetApprovalInfo(Id);
				}
			});
			$(".process_step li").hover(function() {
				var obj = $(this).find('i');
				layer.tips('张三：同意<br/>李四：不同意<br/>', obj, {
					tips: [3, '#3595CC'],
					time: 10000
				});
			}, function() {
				layer.closeAll();
			});

			$(".layui-timeline-item .text-a").click(function() {
				layer.open({
					type: 1,
					title: false,
					closeBtn: 1,
					area: '400px',
					content: $('.linePop2')
				});
			});
			//获取发起人信息和审核进度
			function GetApprovalInfo(Id) {
				Serv.Get('lc/WorkflowMain/GetApprovalInfo', {
					Id: Id
				}, function(data) {
					initPage(data);
					layer_load_lose();
				}, false);
			}
			function initPage(data){
				laytpl($('#process_step_tpl').html()).render(data.approvalInfo.data,function(html){
					$('#process_step').html(html);
				});
				data.createLCInfo.createtime = data.createLCInfo.createtime.FormatDate(true);
				data.createLCInfo.apply_info = form_info_build(data.createLCInfo.formAttribute,data.createLCInfo.formContent);
				laytpl($('#detailTpl').html()).render(data.createLCInfo,function(html){
					$('#detail').html(html);
				});
			}

			function save()
			{
				if (Id > 0) 
				{
					var AudioStatus=$('input[name="opinion"]:checked').val();
					var subData={Id:Id,AudioStatus:AudioStatus,Memo:$("#Memo").val()};
				
					Serv.Post('lc/WorkflowMain/ApprovaIsAgree',subData,function(resultData){
                        if(resultData.succeed)
                        {
                            layer.msg("成功...", {icon:1});
                            setTimeout(function(){
                                history.back(-1);
                            },1000);
                        }else{
                            layer.msg('失败:'+resultData.message, {icon:2});
                        }
                     })
				}else{
					layer.msg('未请求到参数，请刷新页面重新提交！');
				}

			}
		</script>
	</body>
</html>
