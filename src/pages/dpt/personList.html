<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="../../layui/css/layui.css" />
    <link rel="stylesheet" href="../../layui/css/style.css" />
    <link rel="stylesheet" href="../../lib/ztree/css/metroStyle/metroStyle.css" type="text/css" />
    <link rel="stylesheet" href="../../layui/css/common.css" />
    <script type="text/javascript" src="../../lib/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="../../layui/layui.js"></script>
    <script type="text/javascript" src="../../lib/ztree/jquery.ztree.all.min.js"></script>
    <script type="text/javascript" src="../../js/service.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <script type="text/javascript" src="../../js/cache.js"></script>
    <script type="text/javascript" src="../../js/pager.js"></script>
    <script type="text/javascript" src="../../js/ztree.search.left.js"></script>
  </head>

  <body class="bgf2f2f2">
    <div class="childrenBody" style="background:none;">
      <div class="layui-col-md12 layui-col-sm12">
        <div class="layui-col-md3 layui-col-sm3" style="background: #fff;">
          <div>
            <ul id="dptTree" class="ztree"></ul>
          </div>
        </div>
        <div class="layui-col-md9 layui-col-sm9" style="background: #fff;border-left:15px solid #f2f2f2">
          <div class="layui-card-body">
            <table id="lst" lay-filter="lst"></table>
            <script type="text/html" id="bar"></script>
          </div>
        </div>
      </div>
    </div>
    <script>
      var dataCol = [
        [
          {
            field: 'id',
            title: '序号',
          },
          {
            field: 'dptName',
            title: '部门',
            templet: function(d) {
              return $.map(d.bindings, function(item) {
                return item.dptName;
              }).join('|');
            },
          },
          {
            field: 'jobName',
            title: '职位',
            width: 80,
            templet: function(d) {
              return $.map(d.bindings, function(item) {
                return item.jobName;
              }).join('|');
            },
          },
          {
            field: 'userName',
            title: '姓名',
            templet: function(d) {
              return '<a class="text-add" href="/pages/person/personDetails.html?id=' + d.id + '">' + d.userName + '</a>';
            },
            width: 80,
          },
          {
            field: 'status',
            title: '状态',
            templet: function(d) {
              return ['未入职', '试用', '转正', '离职'][d.status];
            },
          },
          {
            field: 'isOpenAccount',
            title: '开通账户',
            templet: function(d) {
              return d.isOpenAccount ? '<span class="text-span">已开通</span>' : '<span class="text-del">未开通</span>';
            },
          },
          {
            field: 'employeeNo',
            title: '工号',
          },
          {
            field: 'roles',
            title: '角色',
          },
          {
            field: 'gender',
            title: '性别',
            width: 60,
            templet: function(d) {
              return ['', '男', '女'][d.gender];
            },
          },
          {
            field: 'linkPhone',
            title: '电话',
            width: 120,
          },
          {
            field: 'officePhone',
            title: '办公电话',
            width: 120,
          },
          {
            title: '操作',
            toolbar: '#toolbar',
            width: 170,
          },
        ],
      ];

      var parameter = {
        companyId: '',
        dptId: '',
      };

      var lstPager;
      layui.use(['table'], function() {
        var table = layui.table;
        var dptZTree = new ZTreeRadio('dptTree', {}, function(event, treeId, treeNode) {
          parameter.companyId = treeNode.companyId;
          parameter.dptId = '';
          if (treeNode.id > 0) {
            parameter.dptId = treeNode.id;
          }
          lstPager.search();
        });
        dptZTree.reload();
        var dptZTreeObj = dptZTree.obj();
        var nodes = dptZTreeObj.getNodes();
        if (nodes.length > 0) {
          parameter.companyId = nodes[0].companyId;
          dptZTreeObj.selectNode(nodes[0]);
        }

        function search() {
          return parameter;
        }
        //分页初始化
        lstPager = Pager(
          table, //lay-ui的table控件
          '员工列表', //列表名称
          'lst', //绑定的列表Id
          '', //绑定的工具条Id
          dataCol, //表头的显示行
          'uc/employee/get', //action url 只能post提交
          search, //获取查询条件的函数
          null, //如果在显示之前需要对数据进行整理需要实现，否则传null
          null, //有选择行才能有的操作，实现该方法,否则传null
          null, //如果有每行的操作栏的操作回调，实现该方法，否则传null
          null,
          'full-100'
        );
      });
    </script>
  </body>
</html>
